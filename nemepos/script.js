var au;(function(au){"use strict";function selectText(element){if(window.getSelection){var selection=window.getSelection();var range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range)}}function parseQuery(search){search=search||document.location.search;var query={};var pairs=search.substr(1).split("&");pairs.forEach(function(t){var i=t.indexOf("=");if(i<0){query[decodeURIComponent(t)]=undefined}else{query[decodeURIComponent(t.substr(0,i))]=decodeURIComponent(t.substr(i+1))}});return query}function parseBoolean(object,property,fallback){if(typeof object==="object"){var value=object[property];if(typeof value==="boolean"){return value}}return fallback}function parseColorMap(object){if(typeof object==="object"){var map_1=object["colorMap"];if(typeof map_1==="object"){var out_1={};Object.getOwnPropertyNames(map_1).forEach(function(k){var v=map_1[k];if(typeof v==="string"){var color=au.rgba.fromCSS(v);if(color!==undefined){out_1[k]=v}}});return out_1}}var colorMap={};for(var i=0;i<42;i++){var degrees=i*180*(3-Math.sqrt(5))%360;var name_1=i<26?String.fromCharCode(65+i):""+(i-26);var hsl="hsl("+degrees.toFixed()+", 25%, 40%)";colorMap[name_1]=hsl}return colorMap}function parseNumber(object,property,min,max,fallback){if(typeof object==="object"){var value=object[property];if(typeof value==="number"&&isFinite(value)){return Math.min(Math.max(min,value),max)}}return fallback}function createOptions(){var object=undefined;try{object=JSON.parse(au.storage.read("settings"))}catch(e){object={}}return{edgeForce:parseNumber(object,"edgeForce",0,1,.5),edgeSize:parseNumber(object,"edgeSize",0,1,.5),nodeForce:parseNumber(object,"nodeForce",0,1,.5),nodeSize:parseNumber(object,"nodeSize",0,1,.5),isFlipped:parseBoolean(object,"isFlipped",false),isColorful:parseBoolean(object,"isColorful",true),isLabeled:parseBoolean(object,"isLabeled",true),colorMap:parseColorMap(object)}}var OptimizerState;(function(OptimizerState){OptimizerState[OptimizerState["Off"]=0]="Off";OptimizerState[OptimizerState["Active"]=1]="Active";OptimizerState[OptimizerState["Ready"]=2]="Ready"})(OptimizerState||(OptimizerState={}));function start(){var dom={input:$("#input"),message:$("#message"),optimizeAnchor:$("#optimize"),optimizeSpinner:$("#optimize-spinner"),optimizeWarning:$("#optimize-warning"),randomize:$("#randomize"),save:$("#save"),settings:$("#settings"),share:$("#share"),sizeDec:$("#size-dec"),sizeInc:$("#size-inc"),svg:$("#svg")};var poset=undefined;var graph=undefined;var optimizer=undefined;var optimizerState=undefined;var options=createOptions();function clearGraph(){dom.svg.html("")}function renderGraph(){dom.svg.html("");graph=undefined;if(poset===undefined){return}graph=au.svg.createGraph(dom.svg.get()[0]);var positionOf=function(n){var p=au.vec2.clone(optimizer.positions[n.name]);if(!options.isFlipped){p.y=optimizer.bounds.height-p.y}return p};for(var layerIndex=0;layerIndex<poset.layers.length;layerIndex++){var layer=poset.layers[layerIndex];var childLayer=poset.layers[layerIndex+1];var _loop_1=function(nodeIndex){var node=layer[nodeIndex];var p1=positionOf(node);if(!node.isGenerated){var color=undefined;if(options.isColorful){color=options.colorMap[node.name];if(color===undefined){color=options.colorMap[node.name.toLowerCase()]}if(color===undefined){color=options.colorMap[node.name.toUpperCase()]}}var text="";if(options.isLabeled){if(node.name[0]!=="."){text=node.name}}graph.addNode(au.svg.createNode({color:color,x:p1.x,y:p1.y,text:text}))}node.children.forEach(function(child){var p2=positionOf(child);graph.addEdge(au.svg.createEdge({x1:p1.x,y1:p1.y,x2:p2.x,y2:p2.y}))})};for(var nodeIndex=0;nodeIndex<layer.length;nodeIndex++){_loop_1(nodeIndex)}}graph.zoomToFit(options.nodeSize,options.edgeSize)}function updateOptimizerDom(newState){if(optimizerState===newState){return}optimizerState=newState;switch(newState){case OptimizerState.Off:{dom.optimizeSpinner.addClass("is-hidden");dom.optimizeAnchor.addClass("is-optimizer-off");dom.optimizeAnchor.removeClass("is-optimizer-ready");dom.optimizeAnchor.removeClass("is-optimizer-active");break}case OptimizerState.Ready:{dom.optimizeSpinner.addClass("is-hidden");dom.optimizeAnchor.addClass("is-optimizer-ready");dom.optimizeAnchor.removeClass("is-optimizer-off");dom.optimizeAnchor.removeClass("is-optimizer-active");break}case OptimizerState.Active:{dom.optimizeSpinner.removeClass("is-hidden");dom.optimizeAnchor.addClass("is-optimizer-active");dom.optimizeAnchor.removeClass("is-optimizer-off");dom.optimizeAnchor.removeClass("is-optimizer-ready");break}}}updateOptimizerDom(OptimizerState.Off);function optimize(){if(poset===undefined){return}if(optimizerState===OptimizerState.Off){return}updateOptimizerDom(OptimizerState.Active);var isFinished=optimizer.optimize();renderGraph();if(isFinished){updateOptimizerDom(OptimizerState.Ready)}else{setTimeout(optimize,1)}}dom.optimizeAnchor.click(function(){if(optimizerState===OptimizerState.Off){updateOptimizerDom(OptimizerState.Ready);optimize()}else{updateOptimizerDom(OptimizerState.Off)}});function parseInput(){try{poset=au.createPartialOrderSet(dom.input.val());dom.message.removeClass("is-message-warning");dom.message.text("parsed as "+poset.toString());au.storage.write("graph",dom.input.val());console.log(poset.sweepStats[0]);console.log(poset.switcharooStats);optimizer=au.createOptimizer(poset,options.nodeForce,options.edgeForce);optimize();renderGraph()}catch(e){poset=undefined;dom.message.addClass("is-message-warning");dom.message.text(e.message);optimizer=undefined;renderGraph()}}dom.input.on("input",function(){var id=-1;return function(e){if(id>=0){clearTimeout(id)}id=setTimeout(function(){id=-1;parseInput()},500)}}());function bound(n,a,b){n=Math.min(Math.max(a,n),b);return Math.round(100*n)/100}function adjustSizes(node,edge){function adjust(n,d){var K=.05;var k=d<0?-K:d>0?K:0;return bound(n+k,0,1)}options.nodeSize=adjust(options.nodeSize,node);options.edgeSize=adjust(options.edgeSize,edge);au.storage.write("settings",JSON.stringify(options));dom.message.html("nodeSize &#8594; "+options.nodeSize.toFixed(2)+"; "+("edgeSize &#8594; "+options.edgeSize.toFixed(2)));renderGraph()}dom.sizeDec.click(function(){return adjustSizes(-1,-1)});dom.sizeInc.click(function(){return adjustSizes(1,1)});$(window).keydown(function(e){if(e.keyCode===219){if(e.shiftKey){adjustSizes(0,-1)}else{adjustSizes(-1,0)}}else if(e.keyCode===221){if(e.shiftKey){adjustSizes(0,1)}else{adjustSizes(1,0)}}});dom.svg.get()[0].addEventListener("wheel",function(e){if(optimizer===undefined){return}function adjust(n,d){var K=.01;var k=d<0?-K:d>0?K:0;return bound(n+k,K,1-K)}if(e.deltaY>0){options.nodeForce=adjust(options.nodeForce,1);options.edgeForce=adjust(options.edgeForce,-1)}else if(e.deltaY<0){options.nodeForce=adjust(options.nodeForce,-1);options.edgeForce=adjust(options.edgeForce,1)}au.storage.write("settings",JSON.stringify(options));dom.message.html("nodeForce &#8594; "+options.nodeForce.toFixed(2)+"; "+("edgeForce &#8594; "+options.edgeForce.toFixed(2)));optimizer.edgeForce=options.edgeForce;optimizer.nodeForce=options.nodeForce;optimizer.reoptimize();if(optimizerState===OptimizerState.Ready){optimize()}});dom.save.click(function(e){if(poset===undefined){dom.save.attr("href","");e.preventDefault();return}dom.save.attr("href",URL.createObjectURL(new Blob([graph.toHTML()],{type:"image/svg+xml"})))});dom.settings.click(function(){var settings=au.createSettings();settings.onhide=function(){au.storage.write("settings",JSON.stringify(settings.content));options=createOptions();au.storage.write("settings",JSON.stringify(options));parseInput()};return function(){settings.content=options;settings.show()}}());dom.randomize.click(function(){var createName=function(){var ASCII_A=65;var x=0;return function(){return function fn(n){return(n<26?"":fn(Math.floor(n/26)-1))+String.fromCharCode(ASCII_A+n%26)}(x++)}}();var createTuple=function(parent,child){return parent+" < "+child};var rnd=function(min,max){return min+Math.floor(Math.random()*(max-min))};var tuples=[];function fn(min,max,parents){if(parents.length===0){return}var children=[];parents.forEach(function(parent){for(var i=rnd(min,max);i>0;i--){var child=createName();children.push(child);tuples.push(createTuple(parent,child))}});children.forEach(function(child){parents.forEach(function(parent){var tuple=createTuple(parent,child);if(tuples.indexOf(tuple)<0){if(rnd(0,parents.length)===0){tuples.push(tuple)}}})});fn(0,max*.75,children)}fn(1,5,[createName()]);dom.input.val(au.createPartialOrderSet(tuples.join(", ")).toString().split(" ").join(""));parseInput()});dom.share.click(function(){if(poset===undefined){return}var port=document.location.port==="80"?"":":"+document.location.port;var encodeName=function(name){if(name.charAt(0)==="."){if(name.length!==2){name="~"+name+"~"}}else if(name.length!==1){name="~"+name+"~"}return name};var components=[];var tuples=poset.tuples;var length=tuples.length;var index=0;while(index<length){var tuple=tuples[index++];var parent_1=tuple.parent;var children=[tuple.child];while(index<length){var nextTuple=tuples[index];if(nextTuple.parent!==parent_1){break}children.push(nextTuple.child);index++}components.push(encodeName(parent_1)+children.map(encodeName).join(""))}var g=components.join("-");dom.message.text(document.location.protocol+"//"+(""+document.location.hostname)+(""+port)+(""+document.location.pathname)+("?g="+encodeURIComponent(g)));selectText(dom.message.get()[0])});function initInput(){var FALLBACK="A<(B,C);C<(D,E),B<(D,E);E<G,D<F;G<(J,K),F<(H,I)";var query=parseQuery();var g=query["g"];if(g===undefined){dom.input.val(au.storage.read("graph")||FALLBACK);parseInput()}else{try{var s_1=au.createScanner(g);var ASCII_DASH_1=45;var ASCII_TILDE_1=126;var ASCII_PERIOD_1=46;var decodeName=function(){var n="";if(s_1.atEndOfInput()||s_1.peek()===ASCII_DASH_1){throw new Error("expected name but encountered "+s_1.format(ASCII_DASH_1)+" at index "+s_1.position)}if(s_1.tryChar(ASCII_TILDE_1)){while(!s_1.tryChar(ASCII_TILDE_1)){n+=String.fromCharCode(s_1.read())}}else if(s_1.tryChar(ASCII_PERIOD_1)){n="."+String.fromCharCode(s_1.read())}else{n=String.fromCharCode(s_1.read())}if(n.length===0){throw new Error("expected name but encountered empty string at index "+s_1.position)}return n};var t=[];while(!s_1.atEndOfInput()){var c=[];var p=decodeName();do{c.push(decodeName())}while(!s_1.atEndOfInput()&&!s_1.tryChar(ASCII_DASH_1));if(c.length===1){t.push(p+"<"+c[0])}else{t.push(p+"<("+c.join(",")+")")}}dom.input.val(t.join(","));parseInput()}catch(e){dom.input.val("");dom.message.text("invalid URL syntax: "+e.message);dom.message.addClass("is-message-warning")}}}initInput()}$(document).ready(start)})(au||(au={}));var au;(function(au){"use strict";function addVector(out,a,b){a.forEach(function(ai,index){return out[index]=ai+b[index]});return out}function cloneVector(a){return a.map(function(ai){return ai})}function copyVector(out,src){src.forEach(function(value,index){return out[index]=value});return out}function createVector(length){var out=[];while(length-- >0){out.push(0)}return out}function multiplyVector(out,a,b){a.forEach(function(ai,index){return out[index]=ai*b[index]});return out}function readOption(actual,fallback){return actual===undefined?fallback:actual}function scaleVector(out,a,k){a.forEach(function(ai,index){return out[index]=k*ai});return out}function subtractVector(out,lhs,rhs){lhs.forEach(function(ai,index){return out[index]=ai-rhs[index]});return out}function createNelderMead(spec){var n=spec.n;var objfunc=spec.objfunc;var unit=readOption(spec.unit,1);var rho=readOption(spec.rho,1);var chi=readOption(spec.chi,n>=2?1+2/n:2);var gamma=readOption(spec.gamma,n>=2?.75-1/(2*n):.5);var sigma=readOption(spec.sigma,n>=2?1-1/n:.5);console.assert(rho>0,"rho "+rho+" is invalid");console.assert(chi>=1&&chi>=rho,"chi "+chi+" is invalid (rho = "+rho+")");console.assert(gamma>0&&gamma<1,"gamma "+gamma+" is invalid");console.assert(sigma>0&&sigma<1,"sigma "+sigma+" is invalid");var stats={iterations:0,evaluations:0,reflections:0,expansions:0,insideContractions:0,outsideContractions:0,shinkages:0};var x=[createVector(n)];if(spec.vertex!==undefined){copyVector(x[0],spec.vertex)}x[0].forEach(function(){return x.push(cloneVector(x[0]))});for(var i=0;i<n;i++){x[i+1][i]+=unit}function evaluate(x){stats.evaluations++;return objfunc(x)}var f=x.map(function(xi){return evaluate(xi)});var sort=function(){var scratch=x.map(function(xi,i){return{i:i,xi:xi,fi:f[i]}});return function(){scratch.forEach(function(ti,i){ti.i=i;ti.xi=x[i];ti.fi=f[i]});scratch.sort(function(a,b){return a.fi<b.fi?-1:b.fi<a.fi?1:0});scratch.forEach(function(ti,i){x[i]=ti.xi;f[i]=ti.fi})}}();sort();function accept(xn,fn){copyVector(x[n],xn);f[n]=fn;sort()}var xbar=createVector(n);var xr=createVector(n);var xc=createVector(n);var xcc=createVector(n);var xe=createVector(n);var vec=createVector(n);return{stats:stats,toString:function(){return x.map(function(y){return y.map(function(z){return z.toFixed(3)}).join("	")}).join("\n")},get delta(){return f[n]-f[0]},get lengthSquared(){var max=0;for(var i=1;i<=n;i++){subtractVector(vec,x[i],x[0]);multiplyVector(vec,vec,vec);max=Math.max(max,vec.reduce(function(p,c){return p+c}))}return max},copyVertex:function(out){copyVector(out,x[0]);return out},iterate:function(){stats.iterations++;copyVector(xbar,x[0]);for(var i=1;i<n;i++){addVector(xbar,xbar,x[i])}scaleVector(xbar,xbar,1/n);subtractVector(xr,xbar,x[n]);scaleVector(xr,xr,rho);addVector(xr,xr,xbar);var fr=evaluate(xr);if(f[0]<=fr&&fr<f[n-1]){stats.reflections++;accept(xr,fr);return}if(fr<f[0]){subtractVector(xe,xr,xbar);scaleVector(xe,xe,chi);addVector(xe,xe,xbar);var fe=evaluate(xe);if(fe<fr){stats.expansions++;accept(xe,fe);return}stats.reflections++;accept(xr,fr);return}if(fr>=f[n-1]){if(fr<f[n]){subtractVector(xc,xr,xbar);scaleVector(xc,xc,gamma);addVector(xc,xc,xbar);var fc=evaluate(xc);if(fc<=fr){stats.outsideContractions++;accept(xc,fc);return}}else{subtractVector(xcc,xbar,x[n]);scaleVector(xcc,xcc,gamma);subtractVector(xcc,xbar,xcc);var fcc=evaluate(xcc);if(fcc<f[n]){stats.insideContractions++;accept(xcc,fcc);return}}}for(var i=1;i<=n;i++){subtractVector(x[i],x[i],x[0]);scaleVector(x[i],x[i],sigma);addVector(x[i],x[i],x[0]);f[i]=evaluate(x[i])}sort();stats.shinkages++}}}au.createNelderMead=createNelderMead})(au||(au={}));var au;(function(au){"use strict";var GRID_SIZE=100;function createOptimizer(poset,nodeForce,edgeForce){var xmax=GRID_SIZE*Math.max(poset.layers.length,poset.layers.reduce(function(p,c){return Math.max(p,c.length)},0));var optimizer={nodeForce:nodeForce,edgeForce:edgeForce,positions:function(){var table={};poset.layers.forEach(function(layer,layerIndex){return layer.forEach(function(node,nodeIndex){return table[node.name]=au.vec2.fromValues(0,GRID_SIZE*layerIndex)})});return table}(),bounds:{left:0,top:0,width:xmax,height:GRID_SIZE*poset.layers.length},optimize:undefined,reoptimize:undefined};function vertexToPositionTable(v){var i=0;var read=function(){return.5+.5*Math.sin(v[i++])};poset.layers.forEach(function(layer){var x=0;layer.forEach(function(node){var p=optimizer.positions[node.name];var dx=read();p.x=x+dx;x+=dx});x+=read();layer.forEach(function(node){return optimizer.positions[node.name].x*=xmax/x})})}var initialVertex=function(){var v=[];var rnd=function(){return Math.asin(.5)};poset.layers.forEach(function(layer){layer.forEach(function(){return v.push(rnd())});v.push(rnd())});return v}();var vertex=initialVertex.slice();var createNM=function(){return au.createNelderMead({n:poset.layers.reduce(function(p,c){return p+c.length+1},0),unit:Math.PI/8,objfunc:function(v){vertexToPositionTable(v);var positionOf=function(n){return optimizer.positions[n.name]};var fmt2=function(v){return"("+v.x.toFixed(3)+" x "+v.y.toFixed(3)+")"};var sum=0;poset.layers.forEach(function(layer){layer.forEach(function(node){var p1=positionOf(node);node.parents.forEach(function(n){var p2=positionOf(n);sum-=optimizer.edgeForce/Math.sqrt(au.vec2.distanceSquared(p1,p2))});node.children.forEach(function(n){var p2=positionOf(n);sum-=optimizer.edgeForce/Math.sqrt(au.vec2.distanceSquared(p1,p2))});layer.forEach(function(n){if(n===node){return}var p2=optimizer.positions[n.name];var dx=Math.abs(p2.x-p1.x);var dy=0*GRID_SIZE+Math.abs(p2.y-p1.y);var d=optimizer.nodeForce/Math.sqrt(dx*dx+dy*dy);sum+=d})})});return sum},vertex:vertex})};var nm=createNM();optimizer.reoptimize=function(){nm.copyVertex(vertex);nm=createNM()};optimizer.optimize=function(){var MAX_MILLISECONDS=25;var timeout=Date.now()+MAX_MILLISECONDS;while(Date.now()<timeout){nm.iterate()}nm.copyVertex(vertex);vertexToPositionTable(vertex);var MIN_ITERATIONS_PER_DIMENSION=50;var minIterations=MIN_ITERATIONS_PER_DIMENSION*vertex.length;if(nm.stats.iterations<minIterations){return false}var DELTA_EPSILON=1e-4;if(nm.delta>DELTA_EPSILON){return false}var LENGTH_SQUARED_EPSILON=1e-4;if(nm.lengthSquared>LENGTH_SQUARED_EPSILON){return false}console.log(nm.stats);return true};initialVertex.forEach(function(n,i){return vertex[i]=n});vertexToPositionTable(vertex);return optimizer}au.createOptimizer=createOptimizer})(au||(au={}));var au;(function(au){"use strict";var ASCII_SPACE=32;var ASCII_TILDE=126;var ASCII_COMMA=44;var ASCII_SEMICOLON=59;var ASCII_LESS_THAN=60;var ASCII_LPAREN=40;var ASCII_RPAREN=41;function parseName(scanner){var anchor=scanner.position;var name=scanner.readToken(function(code){return true&&code>=ASCII_SPACE&&code<=ASCII_TILDE&&code!==ASCII_COMMA&&code!==ASCII_SEMICOLON&&code!==ASCII_LESS_THAN&&code!==ASCII_LPAREN&&code!==ASCII_RPAREN});if(name.length>0){return name}scanner.position=anchor;var actual=scanner.format(scanner.peek());throw new Error("expected name but encountered "+actual+" at index "+scanner.position)}function parseTuples(text){var scanner=au.createScanner(text);var tuples=[];do{var parent_2=parseName(scanner);scanner.require(ASCII_LESS_THAN);var isList=scanner.tryChar(ASCII_LPAREN);do{var child=parseName(scanner);tuples.push({parent:parent_2,child:child})}while(isList&&scanner.tryChar(ASCII_COMMA));if(isList){scanner.require(ASCII_RPAREN)}scanner.skipWhitespace()}while(scanner.tryChar(ASCII_COMMA)||scanner.tryChar(ASCII_SEMICOLON));if(scanner.atEndOfInput()){return tuples}var actual=scanner.format(scanner.peek());throw new Error("expected end of input but encountered "+actual+" at index "+scanner.position)}function createNode(name){var parents=[];var children=[];var node={name:name,parents:parents,children:children,layer:undefined,isGenerated:false,addChild:function(child){children.push(child);child.parents.push(node)},addParent:function(parent){parent.addChild(node)},hasChild:function(child){return children.indexOf(child)>=0},hasParent:function(parent){return parents.indexOf(parent)>=0},removeChild:function(child){var childIndex=children.indexOf(child);if(childIndex>=0){children.splice(childIndex,1)}var parentIndex=child.parents.indexOf(node);if(parentIndex>=0){child.parents.splice(parentIndex,1)}},removeParent:function(parent){parent.removeChild(node)}};return node}function createNodeTable(tuples){var table={};tuples.forEach(function(tuple){[tuple.parent,tuple.child].forEach(function(name){if(name in table){return}var node=createNode(name);table[name]={node:node,isMarked:false}})});tuples.forEach(function(tuple){return table[tuple.parent].node.addChild(table[tuple.child].node)});var nodes=[];tuples.forEach(function(tuple){var parent=table[tuple.parent];if(!parent.isMarked){nodes.push(parent.node);parent.isMarked=true}var child=table[tuple.child];if(!child.isMarked){nodes.push(child.node);child.isMarked=true}});return nodes}function createSortedNodeArray(nodeTable){var visited={};var visting={};var stack=[];nodeTable.forEach(function visit(node){var name=node.name;if(name in visting){throw new Error("invalid partial order set detected with node '"+name+"'")}if(name in visited){return}visting[name]=true;node.children.forEach(visit);delete visting[name];visited[name]=true;stack.push(node)});return stack.reverse()}function createLayers(sortedNodes){var names=sortedNodes.map(function(node){return node.name});var createName=function(){var i=0;while(true){var name_2=".x"+ ++i;if(names.indexOf(name_2)<0){names.push(name_2);return name_2}}};var sortedNodesEx=[];sortedNodes.forEach(function(node){if(node.parents.length===0){node.layer=0;sortedNodesEx.push(node);return}var deepestParent=node.parents.reduce(function(p,c){return c.layer>p.layer?c:p});var parentIndex=0;var end=node.parents.length;while(parentIndex<end){var parent_3=node.parents[parentIndex];if(parent_3.layer===deepestParent.layer){parentIndex++;continue}node.removeParent(parent_3);var p=parent_3;do{var c=createNode(createName());c.layer=p.layer+1;c.isGenerated=true;p.addChild(c);sortedNodesEx.push(c);p=c}while(p.layer!==deepestParent.layer);p.addChild(node);end--}node.layer=deepestParent.layer+1;sortedNodesEx.push(node)});var layerCount=sortedNodesEx.reduce(function(p,c){return Math.max(p,c.layer+1)},0);var layers=[];for(var i=0;i<layerCount;i++){layers.push([])}sortedNodesEx.forEach(function(node){return layers[node.layer].push(node)});return layers}var sweepHeuristics={medianFloor:function(layers,node){var layer0=layers[node.layer-1];var layer2=layers[node.layer+1];var a=[];node.parents.forEach(function(p){return a.push(layer0.indexOf(p))});node.children.forEach(function(p){return a.push(layer2.indexOf(p))});if(a.length===0){return undefined}a.sort();return a[Math.floor(a.length/2)]},medianParentsFloor:function(layers,node){var layer0=layers[node.layer-1];var a=[];node.parents.forEach(function(p){return a.push(layer0.indexOf(p))});if(a.length===0){return undefined}a.sort();return a[Math.floor(a.length/2)]},medianChildrenFloor:function(layers,node){var layer2=layers[node.layer+1];var a=[];node.children.forEach(function(p){return a.push(layer2.indexOf(p))});if(a.length===0){return undefined}a.sort();return a[Math.floor(a.length/2)]},medianCeiling:function(layers,node){var layer0=layers[node.layer-1];var layer2=layers[node.layer+1];var a=[];node.parents.forEach(function(p){return a.push(layer0.indexOf(p))});node.children.forEach(function(p){return a.push(layer2.indexOf(p))});if(a.length===0){return undefined}a.sort();return a[Math.ceil(a.length/2)]},medianParentsCeiling:function(layers,node){var layer0=layers[node.layer-1];var a=[];node.parents.forEach(function(p){return a.push(layer0.indexOf(p))});if(a.length===0){return undefined}a.sort();return a[Math.ceil(a.length/2)]},medianChildrenCeiling:function(layers,node){var layer2=layers[node.layer+1];var a=[];node.children.forEach(function(p){return a.push(layer2.indexOf(p))});if(a.length===0){return undefined}a.sort();return a[Math.ceil(a.length/2)]},medianMean:function(layers,node){var layer0=layers[node.layer-1];var layer2=layers[node.layer+1];var a=[];node.parents.forEach(function(p){return a.push(layer0.indexOf(p))});node.children.forEach(function(p){return a.push(layer2.indexOf(p))});if(a.length===0){return undefined}a.sort();return(a[Math.floor(a.length/2)]+a[Math.ceil(a.length/2)])/2},medianParentsMean:function(layers,node){var layer0=layers[node.layer-1];var a=[];node.parents.forEach(function(p){return a.push(layer0.indexOf(p))});if(a.length===0){return undefined}a.sort();return(a[Math.floor(a.length/2)]+a[Math.ceil(a.length/2)])/2},medianChildrenMean:function(layers,node){var layer2=layers[node.layer+1];var a=[];node.children.forEach(function(p){return a.push(layer2.indexOf(p))});if(a.length===0){return undefined}a.sort();return(a[Math.floor(a.length/2)]+a[Math.ceil(a.length/2)])/2},mean:function(layers,node){var layer0=layers[node.layer-1];var layer2=layers[node.layer+1];var sum=0;node.parents.reduce(function(p,c){return p+layer0.indexOf(c)},0);node.children.reduce(function(p,c){return p+layer2.indexOf(c)},0);var n=node.parents.length+node.children.length;return n===0?undefined:sum/n},meanParents:function(layers,node){var layer0=layers[node.layer-1];var sum=0;node.parents.reduce(function(p,c){return p+layer0.indexOf(c)},0);var n=node.parents.length;return n===0?undefined:sum/n},meanChildren:function(layers,node){var layer2=layers[node.layer+1];var sum=0;node.children.reduce(function(p,c){return p+layer2.indexOf(c)},0);var n=node.children.length;return n===0?undefined:sum/n}};function createCross(parent1,child1,parent2,child2){return{first:{parent:parent1,child:child1},second:{parent:parent2,child:child2},isButterfly:child2.hasParent(parent1)&&child1.hasParent(parent2)}}function findCrosses(layers){var crossTable={rankings:[],crosses:[]};var _loop_2=function(i){var parentLayer=layers[i];var childLayer=layers[i+1];var tuples=[];parentLayer.forEach(function(parent,parentIndex){parent.children.forEach(function(child){var childIndex=childLayer.indexOf(child);tuples.push({parent:parent,parentIndex:parentIndex,child:child,childIndex:childIndex})})});tuples.forEach(function(tuple1){for(var j=0;j<tuples.length;j++){var tuple2=tuples[j];if(tuple1.childIndex<tuple2.childIndex){if(tuple1.parentIndex>tuple2.parentIndex){crossTable.crosses.push(createCross(tuple1.parent,tuple1.child,tuple2.parent,tuple2.child))}}}})};for(var i=0;i+1<layers.length;i++){_loop_2(i)}var rankTable={};layers.forEach(function(layer){return layer.forEach(function(node){return rankTable[node.name]=0})});crossTable.crosses.filter(function(cross){return!cross.isButterfly}).forEach(function(cross){return[cross.first,cross.second].forEach(function(pair){return[pair.parent,pair.child].forEach(function(node){return rankTable[node.name]++})})});layers.forEach(function(layer){return layer.filter(function(node){return rankTable[node.name]>0}).forEach(function(node){return crossTable.rankings.push({node:node,count:rankTable[node.name]})})});crossTable.rankings.sort(function(a,b){return b.count-a.count});return crossTable}function sweep(layers,method,timeout){var heuristic=sweepHeuristics[method];var layerCount=layers.length;var end=layerCount;var iteration=0;var swapCount=0;var _loop_3=function(){var layerIndex=iteration%layerCount;var layer=layers[layerIndex];var parentLayer=layers[layerIndex-1];var childLayer=layers[layerIndex+1];var scores=layer.map(function(node,index){return{node:node,index:index,value:heuristic(layers,node)}});for(var a=0;a<scores.length;a++){if(scores[a].value===undefined){continue}for(var b=a+1;b<scores.length;b++){if(scores[b].value===undefined){continue}if(scores[a].value>scores[b].value){var swap=scores[a];scores[a]=scores[b];scores[b]=swap}}}if(scores.some(function(score,index){return score.index!==index})){swapCount++;scores.forEach(function(score,index){return layer[index]=score.node});end=iteration+layerCount+1}iteration++};while(iteration<end&&performance.now()<timeout){_loop_3()}var crossTable=findCrosses(layers);return{method:method,iterations:iteration,swaps:swapCount,crossTable:crossTable,crosses:crossTable.crosses.length,isAborted:performance.now()>=timeout}}function sweepAll(layers){var TIMEOUT=1e3;var t0=performance.now();var methods=Object.getOwnPropertyNames(sweepHeuristics);var results=methods.map(function(method,index){return sweep(layers,method,t0+(index+1)/methods.length*TIMEOUT)}).sort(function(a,b){return a.crosses-b.crosses});sweep(layers,results[0].method,t0+TIMEOUT);return results}function switcharoo(layers){var timeout=performance.now()+1e3;var table=findCrosses(layers);var crossCount0=table.crosses.length;var iterations=0;var swaps=0;var tests=0;do{}while(table.rankings.some(function(ranking){iterations++;var node=ranking.node;var layer=layers[node.layer];var nodeIndex=layer.indexOf(node);for(var i=0;i<layer.length;i++){if(performance.now()>timeout){return false}if(i===nodeIndex){continue}tests++;var swap=layer[i];layer[i]=node;layer[nodeIndex]=swap;var testTable=findCrosses(layers);if(testTable.crosses.length<table.crosses.length){swaps++;table=testTable;return true}layer[i]=swap;layer[nodeIndex]=node}return false}));return{reduction:crossCount0-table.crosses.length,crossCount:table.crosses.length,crossCount0:crossCount0,iterations:iterations,tests:tests,swaps:swaps,isAborted:performance.now()>=timeout,crossTable:table}}function createPartialOrderSet(text){var tuples=parseTuples(text);var unsortedNodes=createNodeTable(tuples);var sortedNodes=createSortedNodeArray(unsortedNodes);var layers=createLayers(sortedNodes);var sweepStats=sweepAll(layers);var switcharooStats=switcharoo(layers);return{sweepStats:sweepStats,switcharooStats:switcharooStats,tuples:tuples,unsortedNodes:unsortedNodes,sortedNodes:sortedNodes,layers:layers,toString:function(){var i=0;var parents=layers.map(function(layer){return layer.filter(function(n){return n.children.length>0}).map(function(n){return n})}).filter(function(layer){return layer.length>0});return parents.map(function(layer){return layer.map(function(node){if(node.children.length===1){return node.name+" < "+node.children[0].name}var list=node.children.map(function(n){return n.name}).join(", ");return node.name+" < ("+list+")"}).join(", ")}).join("; ")}}}au.createPartialOrderSet=createPartialOrderSet})(au||(au={}));var au;(function(au){var rgba;(function(rgba_1){"use strict";var COLOR_TABLE={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function parseArgsEx(text,length){
var lparen=text.split("(");if(lparen.length!==2){throw new Error("invalid arguments '"+text+"'")}var rparen=lparen[1].split(")");if(rparen.length!==2){throw new Error("invalid arguments '"+text+"'")}var commas=rparen[0].split(",");if(commas.length!==length){throw new Error("invalid arguments '"+text+"'")}return commas}function parseFloatEx(text){var value=parseFloat(text);if(typeof value!=="number"||!isFinite(value)){throw new Error("invalid floating-point number '"+text+"'")}return value}function parseFloatArgsEx(text,length){var args=parseArgsEx(text,length);var numbers=args.map(function(s){return parseFloatEx(s)});return numbers}function parseHex1Ex(text,index){var n=parseIntEx(text.substr(index,1),16);return n*16+n}function parseHex2Ex(text,index){return parseIntEx(text.substr(index,2),16)}function parseIntEx(text,radix){var value=parseInt(text,radix);if(typeof value!=="number"||!isFinite(value)){throw new Error("invalid number '"+text+"'")}return value}function parsePercentEx(text){var n=text.length;if(n>0){if(text.charAt(n-1)==="%"){return parseFloatEx(text.substr(0,n-1))}}throw new Error("invalid percent '"+text+"'")}var R_BRIGHTNESS_SCALING=.2126/255;var G_BRIGHTNESS_SCALING=.7152/255;var B_BRIGHTNESS_SCALING=.0722/255;function brightness(color){return color.r*R_BRIGHTNESS_SCALING+color.g*G_BRIGHTNESS_SCALING+color.b*B_BRIGHTNESS_SCALING}rgba_1.brightness=brightness;function fromCSS(color){color=color.toLowerCase().replace(" ","").replace("	","");if(color in COLOR_TABLE){color=COLOR_TABLE[color]}try{if(color.substr(0,1)==="#"){if(color.length===4){return{r:parseHex1Ex(color,1),g:parseHex1Ex(color,2),b:parseHex1Ex(color,3),a:1}}if(color.length===7){return{r:parseHex2Ex(color,1),g:parseHex2Ex(color,3),b:parseHex2Ex(color,5),a:1}}return undefined}if(color.substr(0,5)==="rgba("){var rgba_2=parseFloatArgsEx(color,4);return{r:rgba_2[0],g:rgba_2[1],b:rgba_2[2],a:rgba_2[3]}}if(color.substr(0,4)==="rgb("){var rgb=parseFloatArgsEx(color,3);return{r:rgb[0],g:rgb[1],b:rgb[2],a:1}}if(color.substr(0,5)==="hsla("){var args=parseArgsEx(color,4);var h=parseFloatEx(args[0]);var s=parsePercentEx(args[1]);var l=parsePercentEx(args[2]);var a=parseFloatEx(args[3]);return fromHSLA(h,s,l,a)}if(color.substr(0,4)==="hsl("){var args=parseArgsEx(color,3);var h=parseFloatEx(args[0]);var s=parsePercentEx(args[1]);var l=parsePercentEx(args[2]);return fromHSL(h,s,l)}}catch(e){console.log("invalid color '"+color+"'",e)}return undefined}rgba_1.fromCSS=fromCSS;function fromHSL(h,s,l){h/=360;s/=100;l/=100;var r=l;var g=l;var b=l;if(s!==0){var hue2rgb=function(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6){return p+(q-p)*6*t}if(t<1/2){return q}if(t<2/3){return p+(q-p)*(2/3-t)*6}return p};var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return{r:Math.round(r*255),g:Math.round(g*255),b:Math.round(b*255),a:1}}rgba_1.fromHSL=fromHSL;function fromHSLA(h,s,l,a){var rgba=fromHSL(h,s,l);rgba.a=a;return rgba}rgba_1.fromHSLA=fromHSLA})(rgba=au.rgba||(au.rgba={}))})(au||(au={}));var au;(function(au){"use strict";var ASCII_TAB=9;var ASCII_LF=10;var ASCII_CR=13;var ASCII_SPACE=32;var ASCII_MINUS=45;var ASCII_PERIOD=46;var ASCII_ZERO=48;var ASCII_NINE=57;var ASCII_TILDE=126;var isWhitespace=function(code){return code===ASCII_SPACE||code===ASCII_LF||code===ASCII_TAB||code===ASCII_CR};function createScanner(s){var length=s.length;var position=0;var peek=function(){return position<length?s.charCodeAt(position):-1};var atDigit=function(){var code=peek();return code>=ASCII_ZERO&&code<=ASCII_NINE};var atEndOfInput=function(){return position>=length};var atWhitespace=function(){return isWhitespace(peek())};var readNumber=function(){var anchor=position;skipWhitespace();var begin=position;tryChar(ASCII_MINUS);skipDigits();if(tryChar(ASCII_PERIOD)){skipDigits()}if(begin===position){position=begin;var actual=format(peek());position=anchor;throw new Error("expected a number but encountered "+actual+" at index "+position)}var text=s.substring(begin,position);var value=parseFloat(text);if(!isFinite(value)){position=anchor;throw new Error("expected a number but encountered "+text+" at index "+position)}return value};var skipDigits=function(){while(atDigit()){position++}};var skipWhitespace=function(){while(atWhitespace()){position++}};var tryChar=function(code){skipWhitespace();if(code!==peek()){return false}position++;return true};var format=function(code){if(code<0){return"end of input"}if(code<ASCII_SPACE||code>ASCII_TILDE){return"ASCII code "+code}var symbol=String.fromCharCode(code);return"symbol '"+symbol+"'"};var read=function(){var code=peek();if(code>=0){position++;return code}throw new Error("expected symbol but encountered "+format(code)+" at index "+position)};var readToken=function(filter){filter=filter||function(code){return!isWhitespace(code)};var begin=position;while(true){var code=peek();if(code<0||!filter(code)){break}position++}return s.substring(begin,position).trim()};var require=function(code){var anchor=position;skipWhitespace();var actualCode=peek();if(actualCode!==code){var required=format(code);var actual=format(actualCode);position=anchor;throw new Error("expected "+required+" but encountered "+actual+" at index "+position)}position++};return{length:length,get position(){return position},set position(value){position=Math.min(Math.max(0,position),length)},peek:peek,atDigit:atDigit,atEndOfInput:atEndOfInput,atWhitespace:atWhitespace,format:format,read:read,readNumber:readNumber,readToken:readToken,require:require,skipDigits:skipDigits,skipWhitespace:skipWhitespace,tryChar:tryChar}}au.createScanner=createScanner})(au||(au={}));var au;(function(au){var TEMPLATE='<div id="settings-layer">\n        <div id="settings-window">\n            <a id="settings-close"><i class="fa fa-times fa-lg"></i></a>\n            <div id="settings-editor"></div>\n        </div>\n    </div>';var ASCII_ESCAPE=27;function createSettings(){var root=$(TEMPLATE);var dom={root:root,window:root.find("#settings-window"),close:root.find("#settings-close"),editor:root.find("#settings-editor")};root.hide();$("body").append(dom.root);var editor=ace.edit("settings-editor");editor.setTheme("ace/theme/eclipse");editor.getSession().setMode("ace/mode/json");editor.$blockScrolling=Infinity;var content="";var settings={get content(){return content},set content(value){content=value},dispose:function(){dom.root.remove()},onhide:undefined,show:function(){editor.setValue(JSON.stringify(content,undefined,2));editor.gotoLine(1);dom.root.fadeIn(100);editor.focus()},hide:function(){dom.root.fadeOut(100);try{content=JSON.parse(editor.getValue())}catch(e){console.log(e)}if(settings.onhide){settings.onhide()}}};dom.close.click(settings.hide);dom.root.click(settings.hide);dom.window.click(function(e){return e.stopPropagation()});editor.container.addEventListener("keydown",function(e){if(e.keyCode===ASCII_ESCAPE){settings.hide()}});return settings}au.createSettings=createSettings})(au||(au={}));var au;(function(au){var storage;(function(storage){var root=document.location.pathname+"#";function read(key){try{return localStorage[root+key]}catch(e){return undefined}}storage.read=read;function write(key,value){try{localStorage[root+key]=value}catch(e){}}storage.write=write})(storage=au.storage||(au.storage={}))})(au||(au={}));var au;(function(au){var svg;(function(svg_1){"use strict";function createElement(elementName,attributes,styles){var element=document.createElementNS("http://www.w3.org/2000/svg",elementName);if(attributes){Object.getOwnPropertyNames(attributes).forEach(function(n){element.setAttributeNS(null,n,attributes[n].toString())})}if(styles){element.setAttributeNS(null,"style",Object.getOwnPropertyNames(styles).map(function(n){return n+":"+styles[n]}).join(";"))}return element}function createGroup(attributes,styles){return createElement("g",attributes,styles)}function createCircle(cx,cy,r,styles){var attributes={cx:cx,cy:cy,r:r};return createElement("circle",attributes,styles)}function createLine(x1,y1,x2,y2,styles){var attributes={x1:x1,y1:y1,x2:x2,y2:y2};return createElement("line",attributes,styles)}function createText(x,y,styles){var attributes={x:x,y:y};return createElement("text",attributes,styles)}function createEdge(spec){spec=spec||{};var x1=spec.x1!==undefined?spec.x1:0;var y1=spec.y1!==undefined?spec.y1:0;var x2=spec.x2!==undefined?spec.x2:1;var y2=spec.y2!==undefined?spec.y2:0;var strokeWidth=spec.strokeWidth!==undefined?spec.strokeWidth:1;var getX1=function(){return x1+"px"};var getY1=function(){return y1+"px"};var getX2=function(){return x2+"px"};var getY2=function(){return y2+"px"};var getStrokeWidth=function(){return strokeWidth+"px"};var dom={line:createLine(getX1(),getY1(),getX2(),getY2(),{stroke:"#333","stroke-width":getStrokeWidth(),"stroke-linecap":"round"})};return{dom:dom,get strokeWidth(){return strokeWidth},get x1(){return x1},get y1(){return y1},get x2(){return x2},get y2(){return y2},set strokeWidth(value){strokeWidth=value;dom.line.style.strokeWidth=getStrokeWidth()},set x1(value){x1=value;dom.line.setAttribute("x1",getX1())},set x2(value){x2=value;dom.line.setAttribute("x2",getX2())},set y1(value){y1=value;dom.line.setAttribute("y1",getY1())},set y2(value){y2=value;dom.line.setAttribute("y2",getY2())}}}svg_1.createEdge=createEdge;function createNode(spec){spec=spec||{};var color=spec.color!==undefined?spec.color:"#333";var radius0=spec.radius0!==undefined?spec.radius0:1;var radius1=spec.radius0!==undefined?spec.radius1:1;var x=spec.x!==undefined?spec.x:0;var y=spec.y!==undefined?spec.y:0;var text=spec.text!==undefined?spec.text:"";var getCX=function(){return x+"px"};var getCY=function(){return y+"px"};var getFontSize=function(){return radius1+"px"};var getR=function(){return(text.length>0?radius1:radius0)+"px"};var getStrokeWidthValue=function(){return radius1*2/18};var getStrokeWidth=function(){return getStrokeWidthValue()+"px"};var getX=function(){return x+"px"};var getY=function(){return y+radius1*6/18+"px"};var getTextFillColor=function(){var obj=au.rgba.fromCSS(color);if(obj===undefined){return"#fff"}var b=au.rgba.brightness(obj);if(b<.85){return"#fff"}return"#444"};var dom={group:createGroup(),circle:createCircle(getCX(),getCY(),getR(),{fill:color,stroke:"#fff","stroke-width":getStrokeWidth()}),text:createText(getX(),getY(),{fill:getTextFillColor(),"text-anchor":"middle","font-size":getFontSize(),"font-family":"'Roboto Condensed',sans-serif"}),textNode:document.createTextNode(text)};dom.group.appendChild(dom.circle);dom.group.appendChild(dom.text);dom.text.appendChild(dom.textNode);return{dom:dom,get color(){return color},get radius0(){return radius0},get radius1(){return radius1},get text(){return text},get x(){return x},get y(){return y},set color(value){color=value;dom.circle.setAttribute("color",color);dom.text.style.textFillColor=getTextFillColor()},set radius0(value){radius0=value;dom.circle.setAttribute("r",getR());dom.circle.style.strokeWidth=getStrokeWidth();dom.text.setAttribute("y",getY());dom.text.style.fontSize=getFontSize()},set radius1(value){radius1=value;dom.circle.setAttribute("r",getR());dom.circle.style.strokeWidth=getStrokeWidth();dom.text.setAttribute("y",getY());dom.text.style.fontSize=getFontSize()},set text(value){text=value;dom.textNode.textContent=value;dom.circle.setAttribute("r",getR())},set x(value){x=value;dom.circle.setAttribute("cx",getCX());dom.text.setAttribute("x",getX())},set y(value){y=value;dom.circle.setAttribute("cy",getCY());dom.text.setAttribute("y",getY())}}}svg_1.createNode=createNode;function createGraph(parent){var nodes=[];var edges=[];var dom={containerGroup:createGroup(),edgesGroup:createGroup(),nodesGroup:createGroup()};dom.containerGroup.appendChild(dom.edgesGroup);dom.containerGroup.appendChild(dom.nodesGroup);parent.appendChild(dom.containerGroup);return{dom:dom,edges:edges,nodes:nodes,addEdge:function(edge){edges.push(edge);dom.edgesGroup.appendChild(edge.dom.line)},addNode:function(node){nodes.push(node);dom.nodesGroup.appendChild(node.dom.group)},zoomToFit:function(nodeSize,edgeSize){if(nodes.length===0){return}var bounds={min:{x:nodes[0].x,y:nodes[0].y},max:{x:nodes[0].x,y:nodes[0].y}};var expand=function(x,y){bounds.min.x=Math.min(bounds.min.x,x);bounds.min.y=Math.min(bounds.min.y,y);bounds.max.x=Math.max(bounds.max.x,x);bounds.max.y=Math.max(bounds.max.y,y)};nodes.forEach(function(n){return expand(n.x,n.y)});edges.forEach(function(e){return expand(e.x1,e.y1)});edges.forEach(function(e){return expand(e.x2,e.y2)});var area={x:bounds.max.x-bounds.min.x,y:bounds.max.y-bounds.min.y};var EPSILON=.01;if(area.x<EPSILON){area.x=area.y}if(area.y<EPSILON){area.y=area.x}if(area.x<EPSILON){area.x=area.y=100}function lerp(p,a,b){p=Math.min(Math.max(0,p),1);return a+(b-a)*p}var K1=1.5;var K2=.5/K1;var K3=3;var K4=1/4;var K5=1/3;var measureRadius=function(n){return n.text.length>0?1:K2};var maxDiameterSum=2*nodes.reduce(function(p,c){return p+measureRadius(c)},0);var maxRadius=K3*Math.min(area.x,area.y)/maxDiameterSum;var minRadius=K4*maxRadius;var radius=lerp(nodeSize,minRadius,maxRadius);var maxStrokeWidth=K2*radius;var minStrokeWdith=K5*maxStrokeWidth;var strokeWidth=lerp(edgeSize,minStrokeWdith,maxStrokeWidth);edges.forEach(function(e){return e.strokeWidth=strokeWidth});nodes.forEach(function(n){n.radius0=strokeWidth*K1;n.radius1=radius});bounds.min.x-=radius;bounds.min.y-=radius;bounds.max.x+=radius;bounds.max.y+=radius;var padding={x:.1*(bounds.max.x-bounds.min.x),y:.1*(bounds.max.y-bounds.min.y)};bounds.min.x-=padding.x;bounds.min.y-=padding.y;bounds.max.x+=padding.x;bounds.max.y+=padding.y;var l=bounds.min.x;var t=bounds.min.y;var w=bounds.max.x-bounds.min.x;var h=bounds.max.y-bounds.min.y;parent.setAttribute("viewBox",l+" "+t+" "+w+" "+h)},toHTML:function(){if(nodes.length===0){return undefined}var k=50/nodes[0].radius1;var svg=parent.cloneNode(true);var scalePixels=function(text){return k*parseFloat(text)+"px"};var scaleAttribute=function(element,name){return element.setAttribute(name,scalePixels(element.getAttribute(name)))};(function scale(n){if(n.localName==="svg"){var t1=n.getAttribute("viewBox");var t2=t1.match(/-?[\d\.]+/g);var t3=t2.map(function(x){return parseFloat(x)*k});var t4=t3.join(" ");n.setAttribute("viewBox",t4)}else if(n.localName==="g"){}else if(n.localName==="line"){n.style.strokeWidth=scalePixels(n.style.strokeWidth);scaleAttribute(n,"x1");scaleAttribute(n,"y1");scaleAttribute(n,"x2");scaleAttribute(n,"y2");return}else if(n.localName==="circle"){n.style.strokeWidth=scalePixels(n.style.strokeWidth);scaleAttribute(n,"r");scaleAttribute(n,"cx");scaleAttribute(n,"cy");return}else if(n.localName==="text"){n.style.fontSize=scalePixels(n.style.fontSize);scaleAttribute(n,"x");scaleAttribute(n,"y");return}else{return}if(n.childNodes!==undefined){for(var i=0;i<n.childNodes.length;i++){scale(n.childNodes.item(i))}}})(svg);return svg.outerHTML}}}svg_1.createGraph=createGraph})(svg=au.svg||(au.svg={}))})(au||(au={}));var au;(function(au){"use strict"})(au||(au={}));var au;(function(au){var vec2;(function(vec2){"use strict";function add(out,a,b){out.x=a.x+b.x;out.y=a.y+b.y;return out}vec2.add=add;function clone(a){return fromValues(a.x,a.y)}vec2.clone=clone;function copy(out,a){out.x=a.x;out.y=a.y;return out}vec2.copy=copy;function create(){return{x:0,y:0}}vec2.create=create;function cross(a,b){return a.x*b.y-a.y*b.x}vec2.cross=cross;function distanceSquared(a,b){var x=b.x-a.x;var y=b.y-a.y;return x*x+y*y}vec2.distanceSquared=distanceSquared;function dot(a,b){return a.x*b.x+a.y*b.y}vec2.dot=dot;function equal(a,b){return a.x===b.x&&a.y===b.y}vec2.equal=equal;function fromValues(x,y){return{x:x,y:y}}vec2.fromValues=fromValues;function lengthSquared(a){return a.x*a.x+a.y*a.y}vec2.lengthSquared=lengthSquared;function multiply(out,a,b){out.x=a.x*b.x;out.y=a.y*b.y;return out}vec2.multiply=multiply;function scale(out,a,b){out.x=a.x*b;out.y=a.y*b;return out}vec2.scale=scale;function subtract(out,a,b){out.x=a.x-b.x;out.y=a.y-b.y;return out}vec2.subtract=subtract})(vec2=au.vec2||(au.vec2={}))})(au||(au={}));